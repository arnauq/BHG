\documentclass[journal, a4paper]{IEEEtran}

% some very useful LaTeX packages include:
\usepackage{siunitx}
\usepackage{cite}      % Written by Donald Arseneau

\usepackage{graphicx}   % Written by David Carlisle and Sebastian Rahtz

\usepackage{subfigure} % Written by Steven Douglas Cochran

\usepackage{url}        % Written by Donald Arseneau
\usepackage{hyperref}
\usepackage{amsmath}    % From the American Mathematical Society
\usepackage{array}
\begin{document}
% Define document title and author
	\title{ BH++: A Black Hole Geodesics Integrator in C++}
	\author{Arnau Quera-Bofarull \\
	\url{https://github.com/arnauq/BHpp}}
	\markboth{Numerical Methods}{A. Quera-Bofarull}
	\maketitle

% Write abstract here
% Each section begins with a \section{title} command
\section{Introduction}
\IEEEPARstart{T}{he} Schwarzschild metric is the metric of a spacetime surrounding a spherical mass $M$ with no charge and no angular momentum. In spherical coordinates is given by (we use \cite{WALD} as reference)
	\begin{equation}
		ds^2 = - \left( 1 - \frac{2GM}{c^2 R} \right) dt^2 + \left( 1- \frac{2GM}{c^2 R} \right)^{-1} dR^2 + R^2 d\Omega.
	\end{equation}
The coordinate singularity $R_s = 2GM/c^2$ is called the Schwarzschild radius, and defines the event horizon beyond which a particle becomes causally disconnected with an outside observer. Typical deviations from Newtonian gravity occur when the central object is very dense, as is the case of neutron stars and black holes. Our goal is to numerically compute the geodesic equations, that is, the trajectory of a gravitationally freely falling particle whose mass is small compared to the central object. The geodesic equation is given by
\begin{equation}
	\frac{d^2 x^\lambda}{d \tau^2} + \Gamma_{ \mu \nu }^{ \lambda} \frac{d x^{\mu}}{d \tau} \frac{d x^{\nu}}{d \tau} = 0,
\end{equation}
where $\Gamma_{ \mu \nu }^{ \lambda}$ are the Christoffel symbols, and we parametrize our curve using the proper time $ \tau $.

The symmetries of the Schwarzschild metric imply the existence of three Killing vectors that lead to conservation of especific energy $E$, especific angular momentum $L$ and allow us to restrict our motion to $\theta = \pi/2$. With this in mind, the geodesic equations for the $t$ and $ \phi $ coordinates reduce to
\begin{equation}
	\begin{split}
		E & = \left( 1 - \frac{2GM}{R} \right) \frac{dt}{d \tau}, \\
		L & = R^2 \frac{d \phi}{d \tau}.
	\end{split}
\end{equation}
Furthermore, the normalization of the position 4-vector $x^\lambda$ yields the radial equation 
\begin{equation}\label{radial_equation}
	\left( \frac{dR}{d \tau} \right)^2 = E^2 - 2 V(R),
\end{equation}
where
\begin{equation}
	V(R) = \frac{c^2}{2} \left( \kappa + \frac{ L^2}{ c^2 R^2} \right) \left( 1 - \frac{2GM}{c^2 R} \right) 
\end{equation}
is the effective potential. The parameter \(\kappa\) takes the value 0 for massless particles and 1 for massive particles.
% Main Part
\section{The integrator algorithm}
We use the Euler-Cromer method to integrate the geodesic equations. As we will see, the Cromer modification ensures that the energy of the particle is conserved along the orbit. Other numerical integrators such as Runge-Kutta methods or the classical Euler one, do not perfom well in this system, since they are not symplectic.
Given a system of ordinary differential equations (ODEs),
\begin{equation}
	\frac{d \vec{x}}{dt} = f( \vec{x} ),
\end{equation}
the Euler method consists on iteratively obtaining the solution by setting
\begin{equation}
	\vec{x}_{n+1} = \vec{x}_{n} + f( \vec{x}_{n} ) \delta \tau.
\end{equation}
In our case the time step $ \delta \tau $ is given by $ \delta \tau = ( \tau _f - \tau _i) / n$, that is, the time interval divided by the number of steps.

When we solve the radial equation \ref{radial_equation}, we need to have in mind the choice of sign for the square root. To avoid dealing with this, we take an additional time derivative in both sides of the equality to get
\begin{equation}
	\frac{d^2R}{d \tau^2} = - 2 \frac{d V(R)}{dR},
\end{equation}
and then reduce it to a system of two first order ODEs,
\begin{equation}
	\begin{split}
		&\frac{dR}{d \tau } = v_R, \\
		&\frac{dv_R}{d \tau} = - 2 \frac{dV}{dR}.
	\end{split}
\end{equation}
The Cromer modification consists on updating the $n$-th radial position by using the $(n+1)$-th radial velocity. In other words, the updating mechanism is
\begin{equation}
	\begin{split}
		&v_{n+1} = v_{n} - 2 \frac{dV(R_n)}{dR}  \delta \tau , \\
		&R_{n+1} = R_n + v_{n+1} \delta \tau.  
	\end{split}
\end{equation}

\section{Testing the algorithm}
In this section, we initialize our solver with initial conditions for known sceneraios: the existence of a circular orbit for photons at $R=\frac{3}{2}R_s$, the last circular orbit for a massive particle at $R=3R_s$, and the planetary system formed by the Sun, the Earth and Jupiter (ignoring the effects of the planets to the metric). All the simulations have been done with a one solar mass black hole.
\subsection{Photon geodesics}
The effective potential for massless particles is
\begin{equation}
	V(R) = \frac{L^2}{2R^2} - \frac{GML^2}{c^2R^3},
\end{equation}
which has an extremum at
\begin{equation}
	\frac{dV}{dR} = 0 \; ; \; R = \frac{3GM}{c^2} = \frac{3}{2} R_s,
\end{equation}
independently of its angular momentum. This corresponds to the circular photon orbit, which is unstable as we can clearly see from the shape of the effective potential in figure \ref{fig::veffphotons}.
\begin{figure}[!hbt]
	\begin{center}
	\includegraphics[width=\columnwidth]{Veff_photon.eps}
	\caption{Effective potential for a photon close to the black hole.}
	\label{fig::veffphotons}
\end{center}
\end{figure}

We initialize a set of 15 photons, one of them at the expected circular orbit, with an arbitrarily chosen specific angular momentum $L=10^8$ $\si[per-mode=symbol]{\meter^2\per \second}$. The results are shown in figure \ref{fig::photon_geodesics}. As we can see, the photon with $R0=1.5R_s$ traces a circular orbit as expected, while the outer photons escape from the black hole and the inner ones get trapped. This is consistent with the extremum being a maximum, hence the circular orbit is unstable. Our integrator gives the same result even after thousands of revolutions, confirming its numerical stability. 
\begin{figure}[!hbt]
	\begin{center}
	\includegraphics[width=\columnwidth]{photon_geodesics.eps}
	\caption{Set of 15 photon orbits initialized at different radii. $R0=1.5$ confirms the photon circular orbit.}
	\label{fig::photon_geodesics}
\end{center}
\end{figure}
\subsection{Massive particle geodesics}
The effective potential for massive particles is
\begin{equation}
	V(R) = \frac{c^2}{2} - \frac{GM}{R} + \frac{L^2}{2R^2} - \frac{GML^2}{c^2R^3},
\end{equation}
which differs from the Newtonian one by the last factor $\sim R^{-3}$ and the rest energy of the particle. We find the circular orbits at the extrema of the effective potential,
\begin{equation}
	\frac{dV}{dr} = 0,
\end{equation}
\begin{equation}
	R_{\pm} = \frac{L^2 \pm \sqrt{ L^4 - \frac{12 G^2 M^2 L^2}{ c^2} } }{2 G M},
\end{equation}
that now depend on angular momentum as opposed to the massless case. The shape of the effective potential for different $L$ is plotted in figure \ref{fig::Veff_massive}
\begin{figure}[!hbt]
	\begin{center}
	\includegraphics[width=\columnwidth]{Veff_massive.eps}
	\caption{Effective potential of massive particles for different values of the angular momentum.}
	\label{fig::Veff_massive}
\end{center}
\end{figure}
We initialize 6 massive particles with different angular momentum at the extrema position. We see that they indeed form circular orbits in figure \ref{fig::massive_geodesics}.
\begin{figure}[!hbt]
	\begin{center}
	\includegraphics[width=\columnwidth]{massive_geodesics.eps}
	\caption{Set of 6 massive particle orbits initialized at different radii and angular momenta. $R_0=3$ confirms the innermost circular orbit.}
	\label{fig::massive_geodesics}
\end{center}
\end{figure}

There is a characteristic radius below which no circular orbits exist, 
\begin{equation}
	L^4 < \frac{ 12 G^2 M^2 L^2}{ c^2} \rightarrow L < \sqrt{12 } G M /c,
\end{equation}
which corresponds to $r<3 R_s$. No particle can orbit in a circular fashion inside this radius, in contrast to the Newtonian case, where it is always possible if the angular momentum is high enough.

\subsection{Newtonian limit: The Solar System}
The last check we perform is initializing the solver with a planteray system consisting of the Earth, Jupiter and the Sun as seen in figure \ref{fig::solarsystem}. The eccentricity of the orbits is $\varepsilon = 0.0034$ for the Earth and $\varepsilon=0.123$ for Jupiter. The disagreement on Jupiter's eccentricity (compared to the observed one) is due to ignoring the gravitational fields from other planets. 
\begin{figure}[!hbt]
	\begin{center}
	\includegraphics[width=\columnwidth]{SolarSystem.eps}
	\caption{Orbits of the Earth and Jupiter around the sun.}
	\label{fig::solarsystem}
\end{center}
\end{figure}
\section{Energy and angular momentum conservation}
To check the symplecticity of our solver, we plot the energy and angular momentum along a given orbit, and confirm that they are indeed conserved. As we can see from figure \ref{fig::ConQuant} 
\begin{figure}[!hbt]
	\begin{center}
	\includegraphics[width=\columnwidth]{ConQuant.eps}
	\caption{Energy and angular momentum for a photon geodesic (red lines) and a massive particle geodesic (blue lines). Both of them remain constant due to the Euler-Cromer method being symplectic.}
	\label{fig::ConQuant}
\end{center}
\end{figure}
\section{Conclusion}
We conclude that our solver perfoms well, being able to obtain the known orbits in different regimes, as well as being stable and conserving energy and angular momentum. In the future, this project will be extended to Kerr metrics, to take into account black hole spins.
% Now we need a bibliography:
\begin{thebibliography}{5}

	\bibitem{WALD} % Book
	R.~M.~Wald. {\em General Relativity}. The University of Chicago Press,
	Chicago, USA, 1984.

\end{thebibliography}

% Your document ends here!
\end{document}
